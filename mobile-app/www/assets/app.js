window.addEventListener('load', function() {
    FastClick.attach(document.body);
}, false);

angular.module('hackisu', ['ngRoute', 'firebase'])
.value('fbURL', 'https://hackisu.firebaseio.com/')

.factory('Firebase', function($firebase, fbURL) {
    return $firebase(new Firebase(fbURL));
})

.config(function($routeProvider) {
    $routeProvider
    .when('/main', {
        controller: 'MainCtrl',
        templateUrl: '/views/main.html'
    })
    .when('/login', {
        controller: 'LoginCtrl',
        templateUrl: '/views/login.html'
    })
    .when('/favs', {
        controller: 'FavoritesCtrl',
        templateUrl: '/views/favorites.html'
    })
    .when('/favs/:favID', {
        controller: 'FavoriteCtrl',
        templateUrl: '/views/favorites.html'
    })
    .when('/find_local', {
        controller: 'FindLocalCtrl',
        templateUrl: '/views/find_local.html'
    })
    .when('/find_local/:busID', {
        controller: 'FindLocalCtrl',
        templateUrl: '/views/find_local.html'
    })
    .when('/survey/:surveyID', {
        controller: 'SurveyCtrl',
        templateUrl: '/views/take_survey.html'
    })
    .otherwise({
        redirectTo: '/login'
    })
})

.controller('MainCtrl', function($scope, Firebase) { })

.controller('LoginCtrl', function($scope, Firebase) {
    
})

.controller('SurveyCtrl', function($scope, $routeParams, $location, Firebase) {
    
    $scope.submit_survey = function() {
        $location.path("/main");
    }
    
    $scope.questions = [
        {
            q_str: "What is the best color?",
            answers: [
                {
                    a_id: 0,
                    a_str: 'Red'
                },
                {
                    a_id: 1,
                    a_str: 'Green'
                },
                {
                    a_id: 2,
                    a_str: 'Blue'
                }
            ],
            response_id: -1
        },
        {
            q_str: "Is the cake a lie?",
            answers: [
                {
                    a_id: 0,
                    a_str: 'Yes'
                },
                {
                    a_id: 1,
                    a_str: 'No'
                },
                {
                    a_id: 2,
                    a_str: 'Inifnity/0'
                }
            ],
            response_id: -1
        }
    ];
})

.controller('FavoritesCtrl', function($scope, $routeParams, Firebase) {
    
    // Get this with firebase...
    $scope.user_favorites = [
        {
            "business_id": 1,
            "surveys": [1,3,5],
            "name": "Lorry's Coffee",
            "description": "Lorry's coffee is a locally owned and operated coffee shop in the heart of Ames, Iowa. Located just across from Iowa State University"
        },
        {
            "business_id": 2,
            "surveys": [2,4,6],
            "name": "Pixels Video Games",
            "description": "We are an independent video game store located in Ames, IA that specializes in anything and everything video game related. From Atari 2600 to PS4 and Xbox One, we buy, sell, and trade it all."
        },
        {
            "business_id": 3,
            "surveys": [7,8,9],
            "name": "Jeff's Pizza Shop",
            "description": "My biggest motivator in the pizza business is the excitement generated by our customers. For me there is no better feeling in the world than seeing a satisfied smile on someone's face."
        }
    ];
    
    $scope.selected = false;
    if($routeParams.favID != null) {
        $scope.selected = true;
        $scope.favID = $routeParams.favID;
        $scope.fav = $scope.user_favorites[$scope.favID - 1];
        
        // Get survey by survey ids in business json
    }
    
})

.controller('FindLocalCtrl', function($scope, $routeParams, $location, Firebase) {
    
    // Get this with firebase...
    $scope.local = [
        {
            business_id: 1,
            surveys: [1,3,5],
            name: "Lorry's Coffee",
            description: "Lorry's coffee is a locally owned and operated coffee shop in the heart of Ames, Iowa. Located just across from Iowa State University"
        },
        {
            business_id: 2,
            surveys: [2,4,6],
            name: "Pixels Video Games",
            description: "We are an independent video game store located in Ames, IA that specializes in anything and everything video game related. From Atari 2600 to PS4 and Xbox One, we buy, sell, and trade it all."
        },
        {
            business_id: 3,
            surveys: [7,8,9],
            name: "Jeff's Pizza Shop",
            description: "My biggest motivator in the pizza business is the excitement generated by our customers. For me there is no better feeling in the world than seeing a satisfied smile on someone's face."
        }
    ];
    
    $scope.goto_link = function(link) {
        $location.path(link);
    }
    
    $scope.selected = false;
    if($routeParams.busID) {
        document.getElementById("back-link").href = "#/find_local";
        $scope.selected = true;
        $scope.busID = $routeParams.busID;
        $scope.business = $scope.local[$scope.busID-1];
        
        // Get survey by survey ids in business json
        $scope.surveys = [
            {
                "survey_id": 1,
                "name": "Test Survey 1",
                "questions": [1,2,3,4,5]
            },
            {
                "survey_id": 2,
                "name": "Test Survey 2",
                "questions": [1,2]
            },
            {
                "survey_id": 3,
                "name": "Test Survey 3",
                "questions": [1,2,3]
            }
        ];
    }
});